<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="/css/pygments.css">
        <title>Simple User Helper for iOS - Yoncise</title>
    </head>
    <body>
        <header>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/category">Category</a></li>
        <li><a href="/about">About</a></li>
    </ul>
</header>


        <div id="post">
	<h1>Simple User Helper for iOS</h1>
	<p class="meta">12 Jul 2011</p>
	<p>I&#8217;m sure there are many ways to store user information to remember if a user is logged in or not, using the key chain api for example. However, I like to keep things really really simple, so I created a simple helper class to deal with my user object and store the info using <code>NSUserDefaults</code> and have a static constructor:</p>
<div class='highlight'><pre><code class='objc'><span class='c1'>// UserHelper.h</span>
	
<span class='k'>@interface</span> <span class='nc'>UserHelper</span> : <span class='nc'>NSObject</span> <span class='p'>{</span>
	<span class='n'>NSString</span> <span class='o'>*</span><span class='n'>currentUserId</span><span class='p'>;</span>
	<span class='n'>NSUserDefaults</span> <span class='o'>*</span><span class='n'>_defaults</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='k'>@property</span><span class='p'>(</span><span class='n'>nonatomic</span><span class='p'>,</span><span class='n'>retain</span><span class='p'>)</span> <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>currentUserId</span><span class='p'>;</span>

<span class='k'>-</span><span class='p'>(</span><span class='kt'>BOOL</span><span class='p'>)</span> <span class='nf'>isValid</span><span class='p'>;</span>
<span class='k'>-</span><span class='p'>(</span><span class='kt'>void</span><span class='p'>)</span> <span class='nf'>clear</span><span class='p'>;</span>

<span class='k'>+</span><span class='p'>(</span><span class='n'>UserHelper</span> <span class='o'>*</span><span class='p'>)</span> <span class='nf'>default</span><span class='p'>;</span>

<span class='k'>@end</span>
	
<span class='c1'>// UserHelper.m</span>
	
<span class='cp'>#import &quot;UserHelper.h&quot;</span>

<span class='k'>@implementation</span> <span class='nc'>UserHelper</span>
<span class='k'>@synthesize</span> <span class='n'>currentUserId</span><span class='p'>;</span>

<span class='c1'>//////////////////////////////////////////////////////////////////////////////////</span>
<span class='cp'>#pragma mark -</span>
<span class='cp'>#pragma mark NSObject</span>

<span class='k'>static</span> <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>kcurrentUser</span> <span class='o'>=</span> <span class='s'>@&quot;currentUser&quot;</span><span class='p'>;</span>

<span class='k'>+</span><span class='p'>(</span><span class='n'>UserHelper</span> <span class='o'>*</span><span class='p'>)</span> <span class='nf'>default</span> <span class='p'>{</span>
	<span class='k'>static</span> <span class='n'>UserHelper</span> <span class='o'>*</span><span class='n'>helper</span> <span class='o'>=</span> <span class='nb'>nil</span><span class='p'>;</span>

	<span class='k'>if</span> <span class='p'>(</span><span class='n'>helper</span> <span class='o'>==</span> <span class='nb'>nil</span><span class='p'>)</span> <span class='p'>{</span>
		<span class='n'>helper</span> <span class='o'>=</span> <span class='p'>[[</span><span class='n'>UserHelper</span> <span class='n'>alloc</span><span class='p'>]</span> <span class='n'>init</span><span class='p'>];</span>
	<span class='p'>}</span>

	<span class='k'>return</span> <span class='n'>helper</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='k'>-</span><span class='p'>(</span><span class='kt'>id</span><span class='p'>)</span> <span class='nf'>init</span> <span class='p'>{</span>

	<span class='k'>if</span> <span class='p'>(</span><span class='n'>self</span> <span class='o'>==</span> <span class='p'>[</span><span class='n'>super</span> <span class='n'>init</span><span class='p'>])</span> <span class='p'>{</span>
		<span class='n'>_defaults</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>NSUserDefaults</span> <span class='n'>standardUserDefaults</span><span class='p'>];</span>
		<span class='n'>currentUserId</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>_defaults</span> <span class='n'>stringForKey</span><span class='o'>:</span><span class='n'>kcurrentUser</span><span class='p'>];</span>
	<span class='p'>}</span>

	<span class='k'>return</span> <span class='n'>self</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='c1'>//////////////////////////////////////////////////////////////////////////////////</span>
<span class='cp'>#pragma mark -</span>
<span class='cp'>#pragma mark Private</span>

<span class='k'>-</span><span class='p'>(</span><span class='kt'>void</span><span class='p'>)</span><span class='nf'>setCurrentUserId:</span><span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span><span class='nv'>_id</span> <span class='p'>{</span>
	<span class='n'>currentUserId</span> <span class='o'>=</span> <span class='n'>_id</span><span class='p'>;</span>
	<span class='p'>[</span><span class='n'>_defaults</span> <span class='n'>setObject</span><span class='o'>:</span><span class='n'>currentUserId</span> <span class='n'>forKey</span><span class='o'>:</span><span class='n'>kcurrentUser</span><span class='p'>];</span>
	<span class='p'>[</span><span class='n'>_defaults</span> <span class='n'>synchronize</span><span class='p'>];</span>
	<span class='p'>[[</span><span class='n'>NSNotificationCenter</span> <span class='n'>defaultCenter</span><span class='p'>]</span> <span class='n'>postNotificationName</span><span class='o'>:</span><span class='s'>@&quot;UserSignedIn&quot;</span> <span class='n'>object</span><span class='o'>:</span><span class='nb'>nil</span><span class='p'>];</span>
<span class='p'>}</span>

<span class='c1'>//////////////////////////////////////////////////////////////////////////////////</span>
<span class='cp'>#pragma mark -</span>
<span class='cp'>#pragma mark Public</span>

<span class='k'>-</span><span class='p'>(</span><span class='kt'>BOOL</span><span class='p'>)</span> <span class='nf'>isValid</span> <span class='p'>{</span>
	<span class='k'>return</span> <span class='p'>[</span><span class='n'>currentUserId</span> <span class='n'>isKindOfClass</span><span class='o'>:</span><span class='p'>[</span><span class='n'>NSString</span> <span class='n'>class</span><span class='p'>]]</span> <span class='o'>&amp;&amp;</span> <span class='p'>[</span><span class='n'>currentUserId</span> <span class='n'>length</span><span class='p'>]</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='k'>-</span><span class='p'>(</span><span class='kt'>void</span><span class='p'>)</span> <span class='nf'>clear</span> <span class='p'>{</span>

	<span class='n'>currentUserId</span> <span class='o'>=</span> <span class='nb'>nil</span><span class='p'>;</span>
	<span class='p'>[</span><span class='n'>_defaults</span> <span class='n'>removeObjectForKey</span><span class='o'>:</span><span class='n'>kcurrentUser</span><span class='p'>];</span>
	<span class='p'>[</span><span class='n'>_defaults</span> <span class='n'>synchronize</span><span class='p'>];</span>
	<span class='p'>[[</span><span class='n'>NSNotificationCenter</span> <span class='n'>defaultCenter</span><span class='p'>]</span> <span class='n'>postNotificationName</span><span class='o'>:</span><span class='s'>@&quot;UserSignedOut&quot;</span> <span class='n'>object</span><span class='o'>:</span><span class='nb'>nil</span><span class='p'>];</span>
<span class='p'>}</span>

<span class='k'>@end</span>
</code></pre></div>
<p>In this helper method I&#8217;m only storing the user Id, but you could always store a user object and serialize/deserialize to JSON to store as <code>NSString</code></p>

<p>Hope this may help someone who is after simple authentication persistence.</p>
</div>


        
    </body>
</html>
